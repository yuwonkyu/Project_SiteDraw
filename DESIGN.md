# DESIGN.md

이 문서는 Project SiteDraw의 설계 과정과 의사결정 내용을 담고 있습니다.

---

## 1. 데이터 분석

### metadata.json을 어떻게 해석했나요?

제 기준에서는 도면으로 봐야하는 목데이터 정보로 트리구조의 도면이라고 생각했습니다.
도면의 분야도 여러가지로 건축,구조,공조설비,배관설비,소방,조경등이 있고, 상하위로 도면이 이어져있는 트리형식의 도면 배치값이 있고, 리비전이라는 버전으로도 나눠진다는점을 알게됬었습니다.

### 데이터 구조를 어떻게 이해했나요?

우선 하나의 건축프로젝트안에 여러도면이 있으면 도면안의 여러분야들이 있고 그 분야에서도 여러 리비전을 보고 확인하고 비교하며 보기 쉽게 하는 구조라고 이해했습니다.
그래서 탐색구조ui에는 컴퓨터의 폴더 탐색기처럼 트리구조로 만들고, 센터에 도면뷰어로 도면들이 보기도 하고 비교도 하며 필요시 표시를 하면서 관리자나 실무자들이 보기 좋아야 한다고 생각했습니다, 마지막으로 오른쪽 현재컨텍스트나 검색,필터기능으로 보조적인 역활을 할 수 있는 기능을 배치했습니다.

타입들은 프로젝트,드로잉, Discipline, 리비전, 트랜스폼(좌표), 폴리곤(영역정보)와 같이 목데이터json에 있듯이 분류하였습니다.

### 더 나은 데이터 표현 방법이 있을까요?

현재 데이터의 구조의 장점이라면 도면 트리 구조로 명확하게 계층 구조가 나타나는점, 요구사항에 맞는 ui를 구성하기 적합하다고 봤습니다.
단점으로는 도면이나 분야별로 이미지, 폴리곤, 레기온등의 다양하게 도면으로 활용하다 보니 스키마의 일관성이 부족하다고 느꼈습니다.

개선을 한다면 공통 필드와 선택 필드를 명확히 분리해서 스키마를 통일하고, 좌표계의 기준점을 명시적으로 정의해서 좌표조정을 더 명확하게 하는 방향이 좋다고 생각했습니다.
단순 정적 Json을 쓰기보다 json Schema을 정의해서 데이터 검증을 하는 것도 런타임오류 방지나 협업에 도움이 될 것 같습니다.

그리고 제안하고자 하는 부분은 이미 json에서도 id를 기반 참조를 잘 쓰고 있지만, disciplines와 regions가 객체 기반 키-값 구조라 순회나 검색 시 키 의존성이 발생할 수 있어, 배열+id 기반으로 정규화하면 확장성과 유연성이 높아질 수 있다고 보았습니다.
또한 revisions내부에 반복되는 필드가 있다면 상위 레벨로 분리해 중복을 줄이는 방식도 고려해볼 수 있을 것 같습니다.

## 2. 접근 방식

### 전체 과제를 어떤 순서와 방식으로 해결하셨나요?

프로젝트를 시작하기 전에 먼저 과제 내용을 노션에 정리했습니다.
요구사항, 일정, 체크포인트, 작업 중 수정 사항과 트러블슈팅을 기록하며 전체 흐름을 구조화했습니다.

전체 일정은 6.5일로 설정했고, 목표는 기능이 완성된 서비스 구현과 심플하고 직관적인 UI 구성이었습니다.

제한된 시간 안에서 완성도를 높이기 위해 반복적인 UI 작업이나 구조 정리 과정에서는 AI를 보조 도구로 활용했습니다.
다만 핵심 로직과 데이터 구조 설계는 직접 판단하고 검증하며 진행했습니다.

- 1. 프로젝트 초기 셋업
     요구사항에 맞는 개발 환경을 구성하고 FSD 기반 폴더 구조로 설계했습니다.
     초기 구조를 명확히 잡는 것이 이후 수정 비용을 줄이는 데 중요하다고 판단했습니다.
- 2. 데이터 분석 및 타입 정의
     metadata.json 구조를 분석한 뒤 Project, Drawing, Discipline, Revision 등 핵심 타입을 먼저 정의했습니다.
     초기에 타입을 고정함으로써 데이터 흐름을 명확히 하고, 구조 변경으로 인한 리팩토링을 최소화했습니다.
- 3. 상태 관리 및 핵심 로직 구현
     메타데이터를 로드하고, 선택된 도면/분야/리비전 상태를 관리하는 로직을 우선 구현했습니다.
     UI보다 기능을 먼저 만든 이유는, UI를 먼저 구성하면 구조 변경 시 수정 범위가 커질 수 있다고 판단했기 때문입니다.
     따라서 동작하는 로직을 먼저 확보한 뒤 UI를 입히는 방식을 선택했습니다.
- 4. UI 컴포넌트 개발
     레이아웃은 좌측 트리, 중앙 뷰어, 우측 정보 패널의 3단 구조로 설계했습니다.
     PC 환경에서는 전체 흐름을 한눈에 볼 수 있도록 구성했고,
     태블릿/모바일 환경에서는 중앙 뷰어를 중심으로 좌우 패널을 토글 방식으로 전환하는 구조를 설계 단계에서 고려했습니다.
- 5. 기능 연결 및 UX 개선
     기능을 연결한 뒤 디버깅과 리팩토링을 진행했으며, 사용자 흐름을 다듬으면서 코드 가독성과 구조 정리를 유지하려고 노력했습니다.

저는 프론트엔드 개발의 매력은 복잡한 요구사항을 단순하고 직관적인 사용자 흐름으로 정리하는 과정이라고 생각합니다.
그래서 구조를 먼저 안정화하고, 기능을 완성한 뒤 UI를 다듬는 방식으로 접근했습니다.

## 3. UI 설계 결정

### 어떤 레이아웃을 선택했고, 왜 그 방식이 최선이라고 판단했나요?

저는 3분할 레이아웃을 선택했습니다.

선택한 이유는

- 1. 도면 데이터의 구조적 특성
     건축 도면이 계층구조를 가지고 있어서 좌측 트리 구조는 데이터 모델과 UI구조가 자연스럽게 매칭되는 형태라고 생각했습니다.
- 2. 사용자에게 익숙한 패턴
     파일 탐색기와 유사한 패턴으로 대부분의 사용자에게 익숙합니다, 새로운 패턴보다는 기존에 익숙한 탐색 경험이 좋을 것이라고 판단했습니다.
- 3. 업무 환경에 최적화된 UI
     실무자가 여러 도면을 빠르게 보고 비교해야 한다고 생각합니다.
     PC환경에서 한 화면에서 여러 기능들을 이용할때 흐름이 끊이지 않고 정보들을 보고 검토하고 해야 업무의 흐름이 매끄러울 것이라고 봅니다.
     3분활 구조로 탐색- 선택 - 검토 가 가능하며 자연스럽게 한 화면을 유지할 수 있는 구조라고 판단했습니다.

탐색 - 실무자가 상할때는 좌특 트리에서 전체 배치도 -> 동별 평면도 -> 분야 -> 리비전 순으로 단계적으로 접근하고,
비교 - 비교가 필요할 시 REV1, REV2를 빠르게 전환하면서 보거나 도면뷰어의 비교버튼을 통해 우측 패널에 있는 리비전들을 눌러 겹쳐서 변경사항을 확인할 수 있도록 구성했습니다.
검색 - 우측 패널에서 도면명 또는 분야 필터를 적용하면, 좌측 트리와 중앙 뷰어가 동기화되도록 설계햇습니다.
상세 검토 - 중앙 뷰어에서 확대/축소 및 이동을 통해 세부 영역을 확인할 수 있어 실제 도면 작업 환경과 유사한 사용성을 제공합니다.

### 고려했던 대안들과 각각의 장단점은 무엇이었나요?

캔버스 오버레이 기반 레이아웃
= 도면뷰어 위에 트리/정보를 오버레이 형태로 배치, 숨기기버튼

장점

- pc에서 뷰어 영역을 가장 크게 확보 가능함
- 인터랙션 중심 UI설게에 유리
  단점
- 도면 일부가 가려질 가능성
- UI 레이어가 많아질수록 복잡성 증가
- 모바일, 화면크기가 작을수록 사용성 저하

반응형으로 테블릿설계 하였으나 추가기능으로 보류

## 4. 기술 선택

### 상태 관리, 스타일링 등을 어떤 기준으로 선택했나요?

기술 스택과 구조는
"현재 프로젝트 규모에 적절한 복잡도인가?",
"향후 확장에 유연한가?"
라는 두가지 기준으로 결정했습니다.

1. 사용한 기술 스택과 선택이유
   React + TypeScript

- 도면, 분야, 리비전 등 계층적 데이터 구조가 명확했기 때문에 타입 안정성을 확보하는 것이 중요했습니다.
- TypeScript를 통해 컴파일 단계에서 구조 오류를 방지하고, 협업 시 데이터 명세를 명확히 할수 있다고 판단했습니다.
- 컴포넌트 기반 구조를 활용해 트리, 뷰어, 정보 패널을 역할 단위로 분리하여 재사용성을 높였습니다.

VITE

- 빠른 개발 서버 속도와 HMR 지원으로 생산성이 높습니다.
- 기본적인 번들 최적화를 지원해 초기 설정 부담이 적습니다.
- 작은 프로젝트 규모라고 판단하였습니다.

FSD (Feature-Sliced Design)

- 기능 단위로 폴더를 분리하여 확장 가능한 구조 설계했습니다.
- UI 중심이 아닌 "기능 중심 구조"로 유지보수성을 확보했습니다.
- 팀 협업 시 파일 충돌과 의존성 꼬임을 줄일 수 있는 구조라고 판단했습니다.

2. 상태 관리 방식과 근거
   Context API + useReducer
   작은 규모의 프로젝트여서 Redux와 같은 라이브러리는 사용하지 않았습니다.
   추후 Redux나 Zustand등으로 마이그레이션이 가능하다고 판단했습니다.

상태 구조 설계

- AppContext
- - 프로젝트 정보
- - 도면 메타데이터 전역 관리
- DrawingContext
- - 선택된 도면
- - 선택된 분야
- - 리비전 상태
- ViewerContext
- - 확대/축소 상태
- - 뷰어 좌표
- - 인터랙션 상태
    역할별로 Context를 분리해 불필요한 리렌더링을 줄이고 책임을 명확히 했습니다.

3. 스타일링 선택 기준
   Tailwind CSS

- 유틸리티 기반 스타일로 빠른 개발과 반복 작업에 적합했습니다.
- 테일윈드머지와 clxs를 이용하여 가독성을 높였습니다.

CSS Modules

- 특정 컴포넌트에서 복잡한 스타일이 필요한 경우에만 사용했습니다.
- 동적 스타일이나 구조적으로 명확한 분리가 필요한 경우에 활용했습니다.

기본적으로 테일윈드css를 쓰되, 필요한 부분만 보완하는 방식을 선택했습니다.

## 5. 어려웠던 점 및 개선 방안

### 과제를 수행하며 겪었던 어려움은 무엇이었나요?

이번 과제에서 가장 어려웠던 부분은 좌표 체계의 복잡성, 데이터 구조의 불규칙성, 그리고 상태 동기화와 타입 안정성 확보였습니다. 단순 UI 구현보다, 구조를 이해하고 일관성 있게 설계하는 과정이 어려웠습니다.

1. 기술적 어려움

1) 좌표 변환(Transform) 구조 이해
   metadata.json에는 imageTransform, polygonTransform 등 여러 변환 체계가 혼재되어 있었고, relativeTo 필드를 통해 상위 도면을 기준으로 좌표가 정의되어 있어 상대 좌표계를 추적해야 했습니다.

특히 상위-하위 도면 간 좌표 정합을 유지하려면, 단순히 좌표를 읽는 것이 아니라 변환 체인을 따라가며 누적 계산해야 했기 때문에 구조 이해에 시간이 많이 소요되었습니다.

2. 불규칙한 데이터 구조

- disciplines는 객체 기반 키-값 구조이고,
- revisions는 배열 구조이며,
- regions는 일부 도면에만 존재하는 선택적 필드였습니다.
- 도면마다 polygon, image, regions 조합이 다르게 존재했습니다.

이로 인해 렌더링 로직에서 조건 분기가 많아졌고, 타입 설계도 복잡해졌습니다.

3. 이미지 뷰어 성능 및 인터렉션

- 대용량 도면 이미지 로딩 시 초기 렌더링 지연
- 확대/축소 시 자연스러운 인터랙션 유지
- 리비전 겹쳐보기 시 레이어 관리 문제

3-1. 마우스 휠 이벤트 충돌
도면 뷰어 확대/축소 시 웹페이지 스크롤이 함께 작동하는 문제

- 브라우저 기본 동작과 커스텀 동작의 충돌
- 뷰어 영역 내에서만 휠 이벤트를 제어해야 하는 요구사항

특히 확대/축소 시 불필요한 리렌더링이 발생하면 체감 성능이 크게 저하되는 문제가 있었습니다.

2. 설계/구현 시 난관

1) 트리 구조와 상태 동기화
   트리 선택 -> 뷰어 업데이트 -> 우측 패널 정보 변경까지
   단방향 데이터 흐름을 유지하는 것이 중요했습니다.

검색이나 필터가 적용될 경우, 트리 상태와 현재 선택된 도면 상태의 일관성을 유지하는 것도 고민 지점이었습니다.

2. 타입 안정성 확보
   메타데이터에 선택적 필드가 많아 TypeScript 타입 정의가 까다로웠습니다.

- disciplines는 동적 키 구조
- position, regions 등은 선택적 필드
- 도면마다 구조가 조금씩 다름

런타임 오류 없이 안정적으로 처리하기 위해 타입 설계를 신중하게 진행해야 했습니다.

3. FSD 구조와 실제 구현 간 균형
   FSD의 계층 분리를 엄격히 적용하려다 보니
   shared와 features 간 의존성 경계 설정이 쉽지 않았습니다.

이론적으로는 깔끔하지만, 실제 구현에서는 과도한 분리가 오히려 생산성을 떨어뜨릴 수 있다는 점을 체감했습니다.

3. 해결 과정

1) 좌표 변환 문제 해결

- 좌표 변환 로직을 shared/lib/coordinates.ts로 분리해 재사용 가능하도록 구성했습니다.
- relativeTo 체인을 재귀적으로 추적하는 유틸 함수를 작성해 누적 변환을 처리했습니다.
- 디버깅을 위해 임시 좌표 시각화 도구를 만들어 실제 좌표 정합을 확인했습니다.

이 과정을 통해 변환 로직을 UI와 분리하고, 테스트 가능한 구조로 개선했습니다.

2. 데이터 구조 정규화

- hasDisciplines, hasRegions 같은 타입 가드 함수를 작성해 안전하게 분기 처리했습니다.
- disciplines 객체를 배열 형태로 변환하는 헬퍼 함수를 만들었습니다.
- 데이터 로드 시점에 정규화된 구조로 변환해 UI에서는 일관된 형태로 사용하도록 했습니다.

이를 통해 렌더링 단계의 조건 분기를 줄이고 구조를 단순화했습니다.

3. 성능 최적화 및 인터랙션 제어

- 이미지 Lazy Loading 적용
- useMemo를 활용해 계산 비용이 높은 트리 렌더링을 메모이제이션
- Context를 역할별로 분리해 불필요한 리렌더링 방지
- 마우스 휠 이벤트 제어 :
- - `e.preventDefault()` + `e.stopPropagation()`으로 브라우저 기본 스크롤 차단
- - 뷰어 컨테이너에 `onWheel` 핸들러 추가, `{ passive: false }` 옵션 설정
- - 마우스 포인터가 뷰어 영역 안에 있을 때만 확대/축소 활성화

특히 Context 분리는 체감 성능 개선에 효과적이었습니다.

4. 타입 안전성 강화

- Record<string, Discipline> 형태로 유연한 타입 설계
- 선택적 체이닝(?.)과 null 병합(??)으로 안전한 접근 처리
- Zod와 같은 런타임 검증 도입을 검토했으나, 이번 과제에서는 적용하지 않았습니다.

향후 실서비스라면 JSON Schema 또는 Zod를 통해 런타임 검증까지 추가하는 것이 필요하다고 판단했습니다.

### 시간이 더 주어진다면 어떤 부분을 개선하고 싶으신가요?

시간이 더 주어진다면,

- UX/UI 개선
- 클린코드화
- 확장성 개선
  세가지를 진행하고 싶습니다.

1. 미완성 기능 보완

1) 반응형 UI 완성
   태블릿/모바일 설계는 진행했습니다.
   추가로 구현하고 싶은 부분은:

- 중앙 뷰어 중심 구조로 재구성
- 좌우 패널 토글 방식 적용
- 도면 뷰어 기능 개선 : 마크업 버벅임, 그림도구(원,사각형등 미리보기 기능 및 좌표 컨트롤), 확대축소시 마크업 위치 유지, 마크업 이후 내보내기

2. 도면 비교 기능 고도화
   현재는 리비전 전환 및 단순 레이어 겹쳐보기 방식입니다.
   개선 방향

- 슬라이더 기반 A/B 비교
- 변경 영역 하이라이트
- 차이점 자동 감지 기능
  변경된 부분을 빠르게 확인 할 수 있는 도구로 발전시키고 싶습니다.

3. 검색 및 필터 확장
   현재는 도면명과 분야 중심의 기본 필터입니다.
   개선 방향

- 전체 텍스트 검색
- 날짜 범위 필터
- 리비전 버전 필터
- 최근 본 도면 기능
  업무 도구 관점에서 탐색 효율을 높이는 방향으로 확장하고 싶습니다.

2. 코드 품질 개선
   리팩토링

- 복잡한 컴포넌트 분리 (Viewer, TreePanel 등)
- 중복 로직을 커스텀 훅으로 추상화
- 매직 넘버 및 하드코딩 상수 정리

구조를 더 명확히 하고 유지보수성을 강화하고 싶습니다.

3. 추가하고 싶은 기능

1) 도면의 마크업 저장

- 내보내기(저장) 기능
- 댓글 기반 협업 기능
- 공유 기능
  실무 도구로 소통을 위한 추가 기능이라고 생각합니다.

2. 측정 도구

- 거리, 면적, 각도 측정
- 좌표 단위 변환(px -> mm)
- 축척 반영
  작업 도구로 확장하는 단계입니다.

3. 히스토리 및 북마크

- 최근 본 도면 기록
- 자주 사용하는 도면 북마크
- 로컬 스토리지 활용
  사용자 편의성 향상을 위한 기능입니다.

4. 실시간 협업 기능

- 간편 메시지
- 실시간 주석 동기화
  3-1의 기능 + 장기적으로 협업플랫폼으로 확장가능성이 있을 경우입니다.

4. 성능 최적화 방향

1) 로딩 최적화

- 이미지 Webp변환

2. 번들 최적화

- 코드 스플리팅 확대
- Tree-shaking 최적화
- 불필요한 의존성 제거

3. 메로리 관리
   -useMemo / useCallback 최적화

- 이미지 캐시 정책 개선
- 메모리 누수 점검

4. 서버 연동 시 개선
   API 기반 구조로 전환할 경우:

- 메타데이터 페이지네이션
- CDN 기반 이미지 배포
- GraphQL로 필요한 데이터만 요청

5. 가상스크롤 적용
   도면 수가 수백 개 이상으로 늘어날 경우

- Virtual Scrolling 적용
- react-window 등 활용

## 참고

- **알려진 이슈**: [TROUBLESHOOTING.md](TROUBLESHOOTING.md#알려진-이슈-known-issues) 참조
- **문제 해결 가이드**: [TROUBLESHOOTING.md](TROUBLESHOOTING.md#troubleshooting-guide) 참조
- **구현된 기능**: [README.md](README.md#구현-기능) 참조

#### 하고 싶은말

일주일이라는 기간동안 작업하였지만 후회 없이 열심히 작업하였습니다.
부족하더라도 좋게 봐주시면 감사드리겠습니다.
(❁´▽`❁) 새해 복 많이 받으세요.
